# Generated by Django 4.2.19 on 2025-11-05 11:03

from django.db import migrations, models

def update_status(apps, schema_editor):
    """
    Update old status to new workflow:
    - Not published or IN_PROGRESS → DRAFT
    - Published or COMPLETED → APPROVED
    Applies to Dref, DrefOperationalUpdate, and DrefFinalReport.
    """
    models = [
        "Dref",
        "DrefOperationalUpdate",
        "DrefFinalReport",
    ]
    for model_name in models:
        Model = apps.get_model("dref", model_name)
        Model.objects.filter(is_published=True).update(status=4)  # Published → APPROVED
        Model.objects.filter(is_published=False).update(status=1)  # Not published → DRAFT

def update_starting_language(apps, schema_editor):
    """
    Populate the starting_language field with 'en' for all existing records.
    """
    models = [
        "Dref",
        "DrefOperationalUpdate",
        "DrefFinalReport",
    ]
    for model_name in models:
        Model = apps.get_model("dref", model_name)
        Model.objects.update(starting_language="en")
        

class Migration(migrations.Migration):

    dependencies = [
        ('dref', '0083_dreffinalreport_total_operation_timeframe_imminent'),
    ]
    operations = [
        migrations.AddField(
            model_name='dref',
            name='addressed_humanitarian_impacts_ar',
            field=models.TextField(blank=True, help_text=' Which of the expected severe humanitarian impacts of the hazard are your actions addressing?', null=True, verbose_name='Addressed Humanitarian Impacts'),
        ),
        migrations.AddField(
            model_name='dref',
            name='addressed_humanitarian_impacts_en',
            field=models.TextField(blank=True, help_text=' Which of the expected severe humanitarian impacts of the hazard are your actions addressing?', null=True, verbose_name='Addressed Humanitarian Impacts'),
        ),
        migrations.AddField(
            model_name='dref',
            name='addressed_humanitarian_impacts_es',
            field=models.TextField(blank=True, help_text=' Which of the expected severe humanitarian impacts of the hazard are your actions addressing?', null=True, verbose_name='Addressed Humanitarian Impacts'),
        ),
        migrations.AddField(
            model_name='dref',
            name='addressed_humanitarian_impacts_fr',
            field=models.TextField(blank=True, help_text=' Which of the expected severe humanitarian impacts of the hazard are your actions addressing?', null=True, verbose_name='Addressed Humanitarian Impacts'),
        ),
        migrations.AddField(
            model_name='dref',
            name='hazard_date_and_location_ar',
            field=models.TextField(blank=True, help_text='When and where is the hazard expected to happen?', null=True, verbose_name='Hazard Date and Location'),
        ),
        migrations.AddField(
            model_name='dref',
            name='hazard_date_and_location_en',
            field=models.TextField(blank=True, help_text='When and where is the hazard expected to happen?', null=True, verbose_name='Hazard Date and Location'),
        ),
        migrations.AddField(
            model_name='dref',
            name='hazard_date_and_location_es',
            field=models.TextField(blank=True, help_text='When and where is the hazard expected to happen?', null=True, verbose_name='Hazard Date and Location'),
        ),
        migrations.AddField(
            model_name='dref',
            name='hazard_date_and_location_fr',
            field=models.TextField(blank=True, help_text='When and where is the hazard expected to happen?', null=True, verbose_name='Hazard Date and Location'),
        ),
        migrations.AddField(
            model_name='dref',
            name='hazard_vulnerabilities_and_risks_ar',
            field=models.TextField(blank=True, help_text='Explain the underlying vulnerabilities and risks the hazard poses for at-risk communities?', null=True, verbose_name='Hazard Vulnerabilities and Risks'),
        ),
        migrations.AddField(
            model_name='dref',
            name='hazard_vulnerabilities_and_risks_en',
            field=models.TextField(blank=True, help_text='Explain the underlying vulnerabilities and risks the hazard poses for at-risk communities?', null=True, verbose_name='Hazard Vulnerabilities and Risks'),
        ),
        migrations.AddField(
            model_name='dref',
            name='hazard_vulnerabilities_and_risks_es',
            field=models.TextField(blank=True, help_text='Explain the underlying vulnerabilities and risks the hazard poses for at-risk communities?', null=True, verbose_name='Hazard Vulnerabilities and Risks'),
        ),
        migrations.AddField(
            model_name='dref',
            name='hazard_vulnerabilities_and_risks_fr',
            field=models.TextField(blank=True, help_text='Explain the underlying vulnerabilities and risks the hazard poses for at-risk communities?', null=True, verbose_name='Hazard Vulnerabilities and Risks'),
        ),
        migrations.AddField(
            model_name='dref',
            name='starting_language',
            field=models.CharField(blank=True, help_text='The language in which this record was first created.', null=True, verbose_name='Starting language'),
        ),
        migrations.AddField(
            model_name='dreffinalreport',
            name='starting_language',
            field=models.CharField(blank=True, help_text='The language in which this record was first created.', null=True, verbose_name='Starting language'),
        ),
        migrations.AddField(
            model_name='drefoperationalupdate',
            name='starting_language',
            field=models.CharField(blank=True, help_text='The language in which this record was first created.', null=True, verbose_name='Starting language'),
        ),
        migrations.AlterField(
            model_name='dref',
            name='status',
            field=models.IntegerField(choices=[(1, 'Draft'), (2, 'Finalizing'), (3, 'Finalized'), (4, 'Approved'), (5, 'Failed')], default=1, verbose_name='status'),
        ),
        migrations.AlterField(
            model_name='dreffinalreport',
            name='status',
            field=models.IntegerField(choices=[(1, 'Draft'), (2, 'Finalizing'), (3, 'Finalized'), (4, 'Approved'), (5, 'Failed')], default=1, verbose_name='status'),
        ),
        migrations.AlterField(
            model_name='drefoperationalupdate',
            name='status',
            field=models.IntegerField(choices=[(1, 'Draft'), (2, 'Finalizing'), (3, 'Finalized'), (4, 'Approved'), (5, 'Failed')], default=1, verbose_name='status'),
        ),
        migrations.RunPython(update_status,reverse_code=migrations.RunPython.noop),
        migrations.RemoveField(
            model_name='dref',
            name='is_published',
        ),
        migrations.RemoveField(
            model_name='dreffinalreport',
            name='is_published',
        ),
        migrations.RemoveField(
            model_name='drefoperationalupdate',
            name='is_published',
        ),
        migrations.RunPython(update_starting_language,reverse_code=migrations.RunPython.noop),
    ]
