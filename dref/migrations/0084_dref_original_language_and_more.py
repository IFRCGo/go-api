# Generated by Django 4.2.19 on 2025-09-16 09:09

from django.db import migrations, models


def update_status(apps, schema_editor):
    """
    Update old status to new workflow:
    - Not published or IN_PROGRESS → DRAFT
    - Published or COMPLETED → APPROVED
    Applies to Dref, DrefOperationalUpdate, and DrefFinalReport.
    """
    models = [
        "Dref",
        "DrefOperationalUpdate",
        "DrefFinalReport",
    ]
    for model_name in models:
        Model = apps.get_model("dref", model_name)
        Model.objects.filter(is_published=True).update(status=4)  # Published → APPROVED
        Model.objects.filter(is_published=False).update(status=1)  # Not published → DRAFT


class Migration(migrations.Migration):

    dependencies = [
        ("dref", "0083_dreffinalreport_total_operation_timeframe_imminent"),
    ]

    operations = [
        migrations.AddField(
            model_name="dref",
            name="original_language",
            field=models.CharField(
                blank=True,
                help_text="The language in which this record was first created.",
                null=True,
                verbose_name="Original language",
            ),
        ),
        migrations.AddField(
            model_name="dreffinalreport",
            name="original_language",
            field=models.CharField(
                blank=True,
                help_text="The language in which this record was first created.",
                null=True,
                verbose_name="Original language",
            ),
        ),
        migrations.AddField(
            model_name="drefoperationalupdate",
            name="original_language",
            field=models.CharField(
                blank=True,
                help_text="The language in which this record was first created.",
                null=True,
                verbose_name="Original language",
            ),
        ),
        migrations.AlterField(
            model_name="dref",
            name="status",
            field=models.IntegerField(
                choices=[(1, "Draft"), (2, "Finalizing"), (3, "Finalized"), (4, "Approved")], default=1, verbose_name="status"
            ),
        ),
        migrations.AlterField(
            model_name="dreffinalreport",
            name="status",
            field=models.IntegerField(
                choices=[(1, "Draft"), (2, "Finalizing"), (3, "Finalized"), (4, "Approved")], default=1, verbose_name="status"
            ),
        ),
        migrations.AlterField(
            model_name="drefoperationalupdate",
            name="status",
            field=models.IntegerField(
                choices=[(1, "Draft"), (2, "Finalizing"), (3, "Finalized"), (4, "Approved")], default=1, verbose_name="status"
            ),
        ),
        migrations.RunPython(update_status, reverse_code=migrations.RunPython.noop),
    ]
