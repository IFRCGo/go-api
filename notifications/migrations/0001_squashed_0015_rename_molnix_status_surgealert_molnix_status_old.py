# Generated by Django 4.2.19 on 2025-04-11 07:51

import django.db.migrations.operations.special
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


# notifications.migrations.0012_surgealert_is_stood_down
def update_stood_down(self, schema_editor):
    "Set is_stood_down value depending on molnix_status for existing records"
    SurgeAlert = self.get_model("notifications", "surgealert")
    for record in SurgeAlert.objects.all():
        record.is_stood_down = True if record.molnix_status == "unfilled" else False
        record.save(update_fields=["is_stood_down"])


class Migration(migrations.Migration):

    replaces = [
        ("notifications", "0001_initial"),
        ("notifications", "0002_subscription_event"),
        ("notifications", "0003_notificationguid"),
        ("notifications", "0004_auto_20200618_1017"),
        ("notifications", "0004_auto_20200618_0904"),
        ("notifications", "0005_merge_20200619_0724"),
        ("notifications", "0006_auto_20200623_0704"),
        ("notifications", "0007_auto_20200810_1116"),
        ("notifications", "0008_auto_20201104_0352"),
        ("notifications", "0009_surgealert_is_active"),
        ("notifications", "0010_surgealert_molnix_status"),
        ("notifications", "0011_surgealert_country"),
        ("notifications", "0012_surgealert_is_stood_down"),
        ("notifications", "0013_auto_20230410_0720"),
        ("notifications", "0014_surgealert_status"),
        ("notifications", "0015_rename_molnix_status_surgealert_molnix_status_old"),
    ]

    initial = True

    dependencies = [
        ("api", "0001_initial"),
        ("deployments", "0033_molnixtag"),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ("api", "0017_auto_20190424_1508"),
    ]

    operations = [
        migrations.CreateModel(
            name="Subscription",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("stype", models.IntegerField(choices=[(0, "new"), (1, "edit")], default=0, verbose_name="subscription type")),
                (
                    "rtype",
                    models.IntegerField(
                        choices=[
                            (0, "event"),
                            (1, "appeal"),
                            (2, "field report"),
                            (3, "surge alert"),
                            (4, "country"),
                            (5, "region"),
                            (6, "disaster type"),
                            (7, "per due date"),
                            (8, "followed event"),
                            (9, "surge deployment messages"),
                            (10, "surge approaching end of mission"),
                            (11, "weekly digest"),
                            (12, "new emergencies"),
                            (13, "new operations"),
                            (14, "general announcements"),
                        ],
                        default=0,
                        verbose_name="record type",
                    ),
                ),
                ("lookup_id", models.CharField(blank=True, editable=False, max_length=20, null=True, verbose_name="lookup id")),
                (
                    "country",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to="api.country",
                        verbose_name="country",
                    ),
                ),
                (
                    "dtype",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to="api.disastertype",
                        verbose_name="disaster type",
                    ),
                ),
                (
                    "region",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to="api.region",
                        verbose_name="region",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="subscription",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="user",
                    ),
                ),
                (
                    "event",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="api.event", verbose_name="event"
                    ),
                ),
            ],
            options={
                "verbose_name": "Subscription",
                "verbose_name_plural": "Subscriptions",
            },
        ),
        migrations.CreateModel(
            name="NotificationGUID",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "api_guid",
                    models.CharField(
                        help_text="Can be used to do a GET request to check on the email sender API side.", max_length=200
                    ),
                ),
                ("email_type", models.CharField(blank=True, max_length=600, null=True)),
                ("to_list", models.TextField(blank=True, null=True)),
            ],
        ),
        migrations.CreateModel(
            name="SurgeAlert",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "atype",
                    models.IntegerField(
                        choices=[
                            (0, "fact"),
                            (1, "SIMS"),
                            (2, "ERU"),
                            (3, "DHEOPS"),
                            (4, "HEOPS"),
                            (5, "surge"),
                            (6, "rapid response"),
                        ],
                        default=0,
                        verbose_name="alert type",
                    ),
                ),
                (
                    "category",
                    models.IntegerField(
                        choices=[(0, "information"), (1, "deployment"), (2, "alert"), (3, "shelter"), (4, "stand down")],
                        default=0,
                        verbose_name="category",
                    ),
                ),
                ("operation", models.CharField(max_length=100, verbose_name="operation")),
                ("message", models.TextField(verbose_name="message")),
                ("deployment_needed", models.BooleanField(default=False, verbose_name="deployment needed")),
                ("is_private", models.BooleanField(default=False, verbose_name="is private?")),
                ("created_at", models.DateTimeField(verbose_name="created at")),
                (
                    "event",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="api.event", verbose_name="event"
                    ),
                ),
                ("message_ar", models.TextField(null=True, verbose_name="message")),
                ("message_en", models.TextField(null=True, verbose_name="message")),
                ("message_es", models.TextField(null=True, verbose_name="message")),
                ("message_fr", models.TextField(null=True, verbose_name="message")),
                ("operation_ar", models.CharField(max_length=100, null=True, verbose_name="operation")),
                ("operation_en", models.CharField(max_length=100, null=True, verbose_name="operation")),
                ("operation_es", models.CharField(max_length=100, null=True, verbose_name="operation")),
                ("operation_fr", models.CharField(max_length=100, null=True, verbose_name="operation")),
                ("closes", models.DateTimeField(blank=True, null=True)),
                ("end", models.DateTimeField(blank=True, null=True)),
                ("molnix_id", models.IntegerField(blank=True, null=True)),
                ("molnix_tags", models.ManyToManyField(blank=True, to="deployments.molnixtag")),
                ("opens", models.DateTimeField(blank=True, null=True)),
                ("start", models.DateTimeField(blank=True, null=True)),
                ("is_active", models.BooleanField(default=True)),
                ("molnix_status", models.CharField(blank=True, max_length=32, null=True)),
                (
                    "country",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to="api.country",
                        verbose_name="country",
                    ),
                ),
                ("is_stood_down", models.BooleanField(default=False, verbose_name="is stood down?")),
            ],
            options={
                "ordering": ["-created_at"],
                "verbose_name": "Surge Alert",
                "verbose_name_plural": "Surge Alerts",
            },
        ),
        migrations.RunPython(
            code=update_stood_down,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.AddField(
            model_name="surgealert",
            name="translation_module_original_language",
            field=models.CharField(
                choices=[("en", "English"), ("es", "Spanish"), ("fr", "French"), ("ar", "Arabic")],
                default="en",
                help_text="Language used to create this entity",
                max_length=2,
                verbose_name="Entity Original language",
            ),
        ),
        migrations.AddField(
            model_name="surgealert",
            name="translation_module_skip_auto_translation",
            field=models.BooleanField(
                default=False, help_text="Skip auto translation operation for this entity?", verbose_name="Skip auto translation"
            ),
        ),
        migrations.RemoveField(
            model_name="surgealert",
            name="molnix_status",
        ),
        migrations.AddField(
            model_name="surgealert",
            name="molnix_status",
            field=models.IntegerField(
                choices=[(0, "Open"), (1, "Stood Down"), (2, "Closed")], default=0, verbose_name="alert status"
            ),
        ),
        migrations.RemoveField(
            model_name="surgealert",
            name="is_active",
        ),
        migrations.RemoveField(
            model_name="surgealert",
            name="is_stood_down",
        ),
    ]
